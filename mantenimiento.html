<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hulk Smash Lateral! (Corregido)</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #222; /* Fondo oscuro para resaltar efectos */
            margin: 0;
            font-family: 'Arial Black', Gadget, sans-serif;
            overflow: hidden;
            perspective: 1000px; /* Para efectos 3D sutiles */
        }

        .scene {
            width: 600px;
            height: 400px;
            /* border: 1px dashed #555; */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hulk-fist-container {
            position: absolute;
            /* El 'left' inicial se gestionará con más cuidado en JS para el reset,
               pero la clase base puede tenerlo para el estado inicial de carga. */
            left: -250px; /* Asegurar que esté bien fuera al inicio */
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            /* La transición se aplicará cuando cambie 'left' por las clases */
            transition: left 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .hulk-fist {
            width: 150px;
            height: 120px;
            background: linear-gradient(135deg, #1e5622 25%, #2c7a30 50%, #3a8e3e 75%);
            border: 4px solid #143a16;
            border-radius: 40px 40px 30px 30px;
            position: relative;
            transform-origin: center right;
            box-shadow: inset -10px -10px 15px rgba(0,0,0,0.3),
                        5px 5px 20px rgba(0,0,0,0.5);
            /* Transición para transformaciones internas del puño */
            transition: transform 0.3s ease-out;
        }

        .finger {
            position: absolute;
            background: linear-gradient(to bottom, #256a29, #1e5622);
            border: 2px solid #143a16;
            border-radius: 20px;
            box-shadow: inset 0 -3px 5px rgba(0,0,0,0.2);
        }
        .finger1 { width: 40px; height: 70px; top: -15px; left: 15px; transform: rotate(-10deg); }
        .finger2 { width: 45px; height: 80px; top: -5px; left: 50px; transform: rotate(-5deg); }
        .finger3 { width: 40px; height: 75px; top: 5px; left: 85px; transform: rotate(0deg); }
        .thumb-base {
            width: 50px; height: 50px;
            background: #1e5622; border: 2px solid #143a16;
            position: absolute; top: 50px; left: -10px;
            border-radius: 20px 0 0 20px;
            transform: rotate(20deg);
        }
        .thumb-base > .thumb-tip {
            width: 35px; height: 35px;
            background: linear-gradient(to bottom, #256a29, #1e5622); border: 2px solid #143a16;
            position: absolute; top: -25px; left: 20px;
            border-radius: 15px;
            transform: rotate(-30deg);
        }

        .text-note {
            width: 200px;
            height: 150px;
            padding: 15px;
            background-color: #fffacd;
            border: 2px solid #e0e0a0;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
            text-align: center;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(2deg);
            z-index: 1;
            transition: transform 0.2s ease-out, opacity 0.2s ease-out, filter 0.2s;
        }

        /* --- ESTADOS DE ANIMACIÓN --- */
        .hulk-fist-container.entering {
            left: calc(50% - 200px); /* Se acerca a la nota */
        }
        .hulk-fist-container.winding-up .hulk-fist {
            transform: rotate(-20deg) scaleX(0.9);
        }
        .hulk-fist-container.smashing {
            left: calc(50% - 75px);
            transition-duration: 0.1s; /* Golpe rápido */
        }
        .hulk-fist-container.smashing .hulk-fist {
            transform: rotate(5deg) scaleX(1.1);
        }
        .hulk-fist-container.retracting {
            left: -250px; /* Se va más allá del inicio */
            transition-duration: 0.8s;
            transition-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
        }
        .hulk-fist-container.retracting .hulk-fist {
            transform: rotate(-10deg);
        }

        .text-note.hit {
            transform: translate(calc(-50% + 50px), -50%) rotate(25deg) scale(0.8);
            opacity: 0.7;
            filter: blur(1px);
        }
        .text-note.breaking::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image:
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><path d="M0 50 L20 30 L40 60 L60 40 L80 70 L100 50" stroke="rgba(0,0,0,0.3)" stroke-width="2" fill="none" stroke-dasharray="5,5" transform="rotate(15 50 50)"/><path d="M30 0 L40 25 L20 50 L50 75 L30 100" stroke="rgba(0,0,0,0.2)" stroke-width="2" fill="none" stroke-dasharray="3,3" transform="rotate(-20 50 50)"/></svg>');
            background-size: 80px 80px;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0;
            animation: showCracks 0.3s forwards;
        }
        @keyframes showCracks { to { opacity: 1; } }

        .text-note.shattered {
            transform: translate(calc(-50% + 100px), calc(-50% + 30px)) rotate(45deg) scale(0.5);
            opacity: 0;
            transition: transform 0.5s ease-in, opacity 0.5s ease-in;
        }

        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0) rotate(0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-6px, 2px) rotate(-0.5deg); }
            20%, 40%, 60%, 80% { transform: translate(6px, -2px) rotate(0.5deg); }
        }
        .scene.shake-effect {
            animation: screenShake 0.25s cubic-bezier(.36,.07,.19,.97) both;
        }

        .particle {
            position: absolute;
            background-color: #c1c193;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
        }

        .shockwave {
            position: absolute;
            width: 20px; height: 20px;
            border: 3px solid rgba(255, 255, 180, 0.7);
            border-radius: 50%;
            left: calc(50% - 10px); top: calc(50% - 10px);
            transform-origin: center;
            opacity: 0; transform: scale(0);
            pointer-events: none; z-index: 8;
        }
        .shockwave.animate { animation: expandShockwave 0.4s ease-out forwards; }
        @keyframes expandShockwave {
            0% { transform: scale(0); opacity: 0.8; }
            80% { opacity: 0.5; }
            100% { transform: scale(10); opacity: 0; }
        }

        .flash-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            opacity: 0; pointer-events: none; z-index: 100;
        }
        .flash-overlay.animate { animation: flashBang 0.2s ease-out forwards; }
        @keyframes flashBang { 0% { opacity: 0.8; } 100% { opacity: 0; } }

        button {
            margin-top: 40px; padding: 15px 30px; font-size: 20px;
            background-color: #009688; color: white;
            border: none; border-radius: 8px; cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        button:hover { background-color: #00796b; }
        button:active { transform: translateY(2px); box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        button:disabled { background-color: #777; cursor: not-allowed; box-shadow: none; }
    </style>
</head>
<body>
    <div class="scene" id="scene">
        <div class="hulk-fist-container" id="hulkFistContainer">
            <div class="hulk-fist" id="hulkFist">
                <div class="finger finger1"></div>
                <div class="finger finger2"></div>
                <div class="finger finger3"></div>
                <div class="thumb-base"><div class="thumb-tip"></div></div>
            </div>
        </div>
        <div class="text-note" id="textNote">¡ESTA NOTA SERÁ ANIQUILADA!</div>
        <div class="shockwave" id="shockwave"></div>
    </div>
    <div class="flash-overlay" id="flashOverlay"></div>
    <button id="smashButton">¡DESTRUIR!</button>

    <script>
        const fistContainer = document.getElementById('hulkFistContainer');
        const fist = document.getElementById('hulkFist');
        const note = document.getElementById('textNote');
        const button = document.getElementById('smashButton');
        const scene = document.getElementById('scene');
        const shockwave = document.getElementById('shockwave');
        const flashOverlay = document.getElementById('flashOverlay');
        const PARTICLE_COUNT = 25;

        function createParticle(x, y) {
            const particle = document.createElement('div');
            particle.classList.add('particle');
            scene.appendChild(particle);
            const size = Math.random() * 8 + 4;
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.left = `${x - size / 2}px`;
            particle.style.top = `${y - size / 2}px`;
            const angle = Math.random() * Math.PI * 2;
            const distance = Math.random() * 80 + 50;
            const duration = Math.random() * 0.5 + 0.4;
            particle.animate([
                { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0.5)`, opacity: 0 }
            ], { duration: duration * 1000, easing: 'cubic-bezier(0.1, 0.7, 0.3, 1)', fill: 'forwards' });
            setTimeout(() => { if (particle.parentNode) particle.parentNode.removeChild(particle); }, duration * 1000 + 100);
        }

        function resetAnimationState() {
            button.disabled = true;
            document.querySelectorAll('.particle').forEach(p => p.remove());

            note.style.display = 'flex';
            note.classList.remove('hit', 'breaking', 'shattered');
            fist.style.transform = ''; // Resetea transformaciones internas del puño
            scene.classList.remove('shake-effect');
            shockwave.classList.remove('animate');
            flashOverlay.classList.remove('animate');

            // --- Corrección Clave ---
            // 1. Quita todas las clases de estado del contenedor del puño.
            fistContainer.classList.remove('entering', 'winding-up', 'smashing', 'retracting');

            // 2. Forzar el puño a su posición inicial (fuera de pantalla) SIN transición.
            //    Esto se hace estableciendo 'transition' a 'none' temporalmente.
            fistContainer.style.transition = 'none';
            fistContainer.style.left = '-250px'; // Posición inicial definida en CSS o un valor seguro fuera de pantalla

            // 3. Forzar un reflow del navegador para que aplique el cambio de 'left' inmediatamente.
            void fistContainer.offsetWidth; // Esto es un truco común para forzar reflow

            // 4. Restaurar la propiedad 'transition' para que las siguientes animaciones (añadiendo clases) funcionen.
            //    Al ponerla a '' (string vacío), tomará el valor definido en el CSS.
            fistContainer.style.transition = '';

            // Opcional: Limpiar explícitamente el 'left' inline si no quieres que interfiera
            // con la clase base, pero el paso anterior de restaurar la transición ya es crucial.
            // fistContainer.style.left = ''; // Si la clase base .hulk-fist-container ya tiene el left:-250px
        }


        button.addEventListener('click', () => {
            if (button.disabled) return;
            resetAnimationState();

            // Pequeño delay para asegurar que el reset y el reflow hayan ocurrido antes de animar.
            // Esto da tiempo al navegador a procesar los cambios de 'resetAnimationState'.
            setTimeout(() => {
                fistContainer.classList.add('entering');
            }, 20); // Un delay muy corto es suficiente

            setTimeout(() => {
                fistContainer.classList.add('winding-up');
            }, 20 + 500); // 500ms de la transición 'entering'

            setTimeout(() => {
                fistContainer.classList.remove('winding-up');
                fistContainer.classList.add('smashing');
                note.classList.add('hit');
                scene.classList.add('shake-effect');
                shockwave.classList.add('animate');
                flashOverlay.classList.add('animate');
                const noteRect = note.getBoundingClientRect();
                const sceneRect = scene.getBoundingClientRect();
                const impactX = noteRect.left - sceneRect.left + noteRect.width / 2;
                const impactY = noteRect.top - sceneRect.top + noteRect.height / 2;
                for (let i = 0; i < PARTICLE_COUNT; i++) createParticle(impactX, impactY);
            }, 20 + 500 + 300); // 300ms de la transición 'winding-up' (implícita en .hulk-fist)

            setTimeout(() => {
                note.classList.add('breaking');
            }, 20 + 500 + 300 + 100); // 100ms después del impacto

            setTimeout(() => {
                note.classList.remove('hit');
                note.classList.add('shattered');
            }, 20 + 500 + 300 + 100 + 200); // 200ms para 'breaking'

            setTimeout(() => {
                fistContainer.classList.remove('smashing');
                fistContainer.classList.add('retracting');
                scene.classList.remove('shake-effect');
            }, 20 + 500 + 300 + 100 + 200 + 100);

            setTimeout(() => {
                button.disabled = false;
                // Opcional: resetear completamente para el siguiente golpe
                // setTimeout(resetAnimationState, 1000); // Si quieres que el puño vuelva a su pos inicial
            }, 20 + 500 + 300 + 100 + 200 + 100 + 800); // 800ms de 'retracting'
        });
    </script>
</body>
</html>
